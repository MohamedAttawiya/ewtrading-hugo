{{- $id := site.Params.analytics.ga4.measurement_id | default "" -}}
{{- $enabled := site.Params.analytics.ga4.enabled | default true -}}
{{- if and $enabled $id -}}
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id={{ $id | urlquery }}"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    // Defer config until the browser is idle to reduce main-thread contention during initial render.
    (window.requestIdleCallback || function(cb){setTimeout(cb, 1500);})(function(){
      gtag('config', '{{ $id }}');
    });
  </script>
{{- end -}}
